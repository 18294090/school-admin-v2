{% extends "base.html" %}
{% from 'bootstrap/form.html' import render_field %}
{%block title%}
<TITLE></TITLE>
{%endblock%}
{% block main%}
<div class="container-fluid">
<div class="row">
    <div class="col-md-10">
    <div id="card">        
    <img src="data:image/png;base64,{{student_card}}" alt="student_card" width="100%" height="100%">
    </div>
    </div>
    <div class="col-md-2">
    <div class="card">
    {%if current_user.role.has_permission(Permission.publish_job)%}
    <button class="btn btn-primary" onclick="update()">更新阅卷信息</button>
    {%endif%}
    </div>
    </div>
</div>
<script src="/static/build/js/jquery.min.js"></script>
<script >
csrf_token="{{csrf_token()}}";
function update(){
    $.ajax({
        url:"/job/update/",
        type:"POST",
        headers:{"X-CSRFToken":csrf_token},
        contentType:"application/json",
        data:JSON.stringify({
            "student_id":"{{number}}",
            "job_id":"{{job_id}}" ,            
            'answers':{{answers|safe}},
        }),
        success:function(data){
            if(data=="success"){
                alert("更新成功");            
                window.location.href="/job/job_info/{{job_id}}";
            }
            else{
                alert(data);
            }
        }
    })
}
</script>
{%endblock%}